function SERP(a,b){this.query=a;this.options={};if(b)this.options=b;this.CONFIG={};this.CONFIG.SERP_API_BASE_URL="/explore";this.CONFIG.AJAX_TIMEOUT=1E4}SERP.prototype.setInsertionPoint=function(a){this.insertion_point=a};SERP.prototype._getErrMsg=function(a){return'<div class="err">'+a+"</div>"};SERP.prototype._removeLoadingMsg=function(){$(this.insertion_point).prev(".loading_msg_wrapper").remove()};
SERP.prototype._addSearchFooters=function(){$(this.insertion_point).append('<div id="serp_footer"></div>');this._addSafeSearchFooter()};SERP.prototype._addSafeSearchFooter=function(){var a,b;a="Safe Search";b=true;if(this.options.query_params.safe_search==="0")b=false;a+=b===false?" OFF (explicit content allowed)":" ON (explicit content not allowed)";a='<div id="safe_search_msg">'+a+"</div>";$(this.insertion_point+" #serp_footer").append(a)};
SERP.prototype._buildRequestDataObject=function(){var a={q:this.query};if(this.options.query_params==undefined)return a;for(var b in this.options.query_params){var c=this.options.query_params;c[b]==""||!c.hasOwnProperty(b)||(a[b]=c[b])}return a};
SERP.prototype.insertResults=function(){var a=this,b={cache:true,type:"GET",dataType:"json",timeout:a.CONFIG.AJAX_TIMEOUT,url:a.CONFIG.SERP_API_BASE_URL+"/"+a.category,data:a._buildRequestDataObject(),error:function(){a._handleResultsError()},success:function(c){a._handleResultsSuccess(c)},complete:function(){a._handleResultsComplete()}};jQuery.ajax(b)};
SERP.prototype._handleResultsSuccess=function(a){var b="";b=a.error?this._getErrMsg(a.error):a.data===undefined?this._getErrMsg("No results found.  Please try again later."):jQuery.isArray(a.data)?a.data.length==0?this._getErrMsg("No results found."):this._resultFactory(a):this._getErrMsg("An error has occurred.");$(this.insertion_point).append(b);this._insertDebugs(a)};SERP.prototype._handleResultsError=function(){var a=this._getErrMsg("There was an error retrieving your search results.");$(this.insertion_point).append(a)};
SERP.prototype._handleResultsComplete=function(){this._removeLoadingMsg();this._addSearchFooters()};
SERP.prototype._formatPostedDate=function(a,b){if(!a)return"";a=b?parseInt(a,10)*1E3:parseInt(a,10);var c=new Date(a);if(!c)return"";c=Math.abs((new Date).getTime()-c.getTime());var d="";d="";var e=0;if(c<6E4){d="second";e=Math.round(c/1E3)}else if(c<36E5){d="min";e=Math.round(c/6E4)}else if(c<864E5){d="hr";e=Math.round(c/36E5)}else{d="day";e=Math.round(c/864E5)}if(e>1)d+="s";return d=e+"&nbsp;"+d+"&nbsp;ago"};
SERP.prototype._truncate=function(a,b){if(!a)return"";if(typeof a!=="string")a+="";b=Math.round(b);if(a.length>b){a=a.substring(0,b);a+="..."}return a};SERP.prototype._insertDebugs=function(a){if(a.debug!=undefined){a=a.debug;a='<div id="debug"><pre>'+a+"</pre></div>";$("body").append(a)}};SERP.prototype.init=function(){this.setInsertionPoint(".serp_results");this.insertResults();$("#google_search_form").submit(function(){$("#google_search_form_entry").blur()})};
